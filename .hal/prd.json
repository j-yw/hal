{
  "project": "Hal",
  "branchName": "hal/consolidate-progress-files",
  "description": "Consolidate auto-progress.txt into progress.txt so both manual and auto workflows use a single progress file",
  "userStories": [
    {
      "id": "US-001",
      "title": "Remove AutoProgressFile constant from template package",
      "description": "As a developer, I need the codebase to use a single progress file constant so both workflows write to the same location.",
      "acceptanceCriteria": [
        "Remove AutoProgressFile = \"auto-progress.txt\" constant from internal/template/template.go:25",
        "Remove AutoProgressFile: DefaultProgress from DefaultFiles() map at internal/template/template.go:35",
        "hal init no longer creates auto-progress.txt",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Completed - removed constant and updated all usages to make it compile"
    },
    {
      "id": "US-002",
      "title": "Update auto pipeline to use unified progress file",
      "description": "As an operator running hal auto, I want progress written to progress.txt so hal review can see my work.",
      "acceptanceCriteria": [
        "Change template.AutoProgressFile to template.ProgressFile in internal/compound/pipeline.go:495",
        "Update error messages at lines 501 and 504 to reference ProgressFile",
        "Change ProgressFile: template.AutoProgressFile to ProgressFile: template.ProgressFile in loop config at line 511",
        "Auto pipeline writes to progress.txt",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Completed as part of US-001 to make codebase compile"
    },
    {
      "id": "US-003",
      "title": "Add migration logic for existing auto-progress.txt",
      "description": "As a user with an existing auto-progress.txt, I want its content merged into progress.txt when running hal auto so I don't lose progress history.",
      "acceptanceCriteria": [
        "Before progress file initialization in runLoopStep(), check if auto-progress.txt exists",
        "If auto-progress.txt exists and progress.txt is empty/default, append auto-progress content to progress.txt",
        "If both files have content, append auto-progress content to progress.txt with separator line",
        "Delete auto-progress.txt after successful migration",
        "Migration is logged to display output",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Implemented migrateAutoProgress() method in pipeline.go"
    },
    {
      "id": "US-004",
      "title": "Fix hardcoded path in hal review context gathering",
      "description": "As a user running hal review, I want progress read from the correct location using the template constant so maintenance is easier.",
      "acceptanceCriteria": [
        "Add github.com/jywlabs/hal/internal/template import to internal/compound/review.go",
        "Change hardcoded filepath.Join(dir, \".hal\", \"progress.txt\") to filepath.Join(dir, template.HalDir, template.ProgressFile) at line 133",
        "Behavior unchanged for review command",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Updated review.go to use template constants"
    },
    {
      "id": "US-005",
      "title": "Add JSON PRD reading to hal review context",
      "description": "As a user running hal review, I want the review to see task completion status from JSON PRDs so recommendations are based on actual progress.",
      "acceptanceCriteria": [
        "Add PRDJSONContent string and AutoPRDContent string fields to reviewContext struct",
        "After reading markdown PRD (around line 155), read prd.json content if exists",
        "Read auto-prd.json content if exists",
        "Update hasAnyContext() to include new JSON PRD fields",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Added JSON PRD fields and reading logic to review.go"
    },
    {
      "id": "US-006",
      "title": "Include JSON PRD content in review prompt",
      "description": "As a user running hal review, I want the AI to see task completion percentages so it can accurately report what's done vs remaining.",
      "acceptanceCriteria": [
        "Update buildReviewPrompt() to include PRDJSONContent section when available",
        "Update buildReviewPrompt() to include AutoPRDContent section when available",
        "Truncate JSON PRD content to reasonable size (5000 chars each)",
        "Dry-run output shows JSON PRD context sizes when available",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Updated review prompt and dry-run output"
    },
    {
      "id": "US-007",
      "title": "Remove AutoProgressFile from archive feature state files",
      "description": "As a developer, I need the archive system to stop treating auto-progress.txt as a feature state file since it no longer exists.",
      "acceptanceCriteria": [
        "Remove template.AutoProgressFile from featureStateFiles slice in internal/archive/archive.go:23",
        "hal archive no longer includes auto-progress.txt in new archives",
        "Old archives with auto-progress.txt still restore correctly (restore iterates all files)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Completed as part of US-001 to make codebase compile"
    },
    {
      "id": "US-008",
      "title": "Update archive command help text",
      "description": "As a user reading help text, I want accurate documentation about which files are archived.",
      "acceptanceCriteria": [
        "Remove auto-progress.txt from the archived files list in cmd/archive.go:27 Long description",
        "Help text accurately reflects current behavior",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Update archive tests for consolidated progress",
      "description": "As a developer, I need tests to pass after removing AutoProgressFile references.",
      "acceptanceCriteria": [
        "Remove writeFile(t, filepath.Join(halDir, template.AutoProgressFile), ...) calls from internal/archive/archive_test.go",
        "Remove template.AutoProgressFile from verification slices in tests",
        "Update auto-state only archives test (line ~148-165) to use ProgressFile instead",
        "All archive tests pass",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Completed as part of US-001 to make tests pass"
    },
    {
      "id": "US-010",
      "title": "Add hal cleanup command",
      "description": "As a user who upgraded hal, I want a command to remove orphaned files like auto-progress.txt that are no longer used.",
      "acceptanceCriteria": [
        "Create cmd/cleanup.go with hal cleanup command",
        "Command checks for and removes orphaned auto-progress.txt in .hal/",
        "Command reports which files were removed",
        "Command is idempotent (safe to run multiple times)",
        "Add --dry-run flag to preview what would be removed",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Document consolidation pattern in AGENTS.md",
      "description": "As a future developer, I want documentation about why progress files were consolidated so I understand the design decision.",
      "acceptanceCriteria": [
        "Add Patterns from hal/consolidate-progress-files section to AGENTS.md",
        "Document that progress.txt is the single source of truth for both workflows",
        "Document migration approach (append with separator)",
        "Document that old auto-progress.txt files are orphaned but harmless",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    }
  ]
}
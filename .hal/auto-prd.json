{
  "project": "goralph",
  "branchName": "compound/compound-pipeline-foundations",
  "description": "Harden internal/compound core types, config loader, and config template with validation and unit test coverage, and verify hal init installs compound config and reports directory correctly.",
  "userStories": [
    {
      "id": "T-001",
      "title": "Add Validate() method to AutoConfig",
      "description": "As a developer, I need a Validate() method on AutoConfig so that invalid configurations are caught early with clear error messages.",
      "acceptanceCriteria": [
        "Add Validate() error method to AutoConfig in internal/compound/config.go",
        "Validate returns error when ReportsDir is empty (message: \"auto.reportsDir must not be empty\")",
        "Validate returns error when BranchPrefix is empty (message: \"auto.branchPrefix must not be empty\")",
        "Validate returns error when MaxIterations is \u003c= 0 (message: \"auto.maxIterations must be greater than 0\")",
        "LoadConfig calls Validate() on the merged config before returning",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-002",
      "title": "Unit tests for DefaultAutoConfig",
      "description": "As a developer, I need tests that verify DefaultAutoConfig returns correct default values so that any accidental change to defaults is caught.",
      "acceptanceCriteria": [
        "Create internal/compound/config_test.go (no integration build tag)",
        "Test DefaultAutoConfig() returns ReportsDir == \".hal/reports\"",
        "Test DefaultAutoConfig() returns BranchPrefix == \"compound/\"",
        "Test DefaultAutoConfig() returns MaxIterations == 25",
        "Test DefaultAutoConfig() returns empty QualityChecks slice (length 0)",
        "go test ./internal/compound/... passes (no integration tag needed)",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-003",
      "title": "Unit tests for LoadConfig with missing file",
      "description": "As a developer, I need tests covering the missing-file path of LoadConfig so that defaults are reliably returned when no config.yaml exists.",
      "acceptanceCriteria": [
        "Add test in config_test.go: LoadConfig with non-existent directory returns defaults (not an error)",
        "Add test: LoadConfig with directory that exists but has no config.yaml returns defaults",
        "Verify returned config matches DefaultAutoConfig() for ReportsDir, BranchPrefix, MaxIterations, and QualityChecks",
        "go test ./internal/compound/... passes",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-004",
      "title": "Unit tests for LoadConfig with valid YAML",
      "description": "As a developer, I need tests that verify LoadConfig correctly parses a valid config.yaml and merges with defaults.",
      "acceptanceCriteria": [
        "Add test: write a full config.yaml (all auto fields set) to t.TempDir(), call LoadConfig, verify all fields are read correctly",
        "Add test: write a partial config.yaml (only auto.reportsDir set), verify missing fields use defaults from DefaultAutoConfig()",
        "Add test: write config.yaml with empty auto: section, verify all fields use defaults",
        "Use table-driven test pattern",
        "go test ./internal/compound/... passes",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-005",
      "title": "Unit tests for LoadConfig with invalid YAML and validation errors",
      "description": "As a developer, I need tests covering error paths so that corrupt YAML and validation failures are handled correctly.",
      "acceptanceCriteria": [
        "Add test: write invalid YAML content (e.g., \":::not yaml\") to config.yaml, verify LoadConfig returns an error",
        "Add test: write YAML with auto.maxIterations: -1, verify LoadConfig returns validation error containing \"maxIterations\"",
        "Add test: write YAML with auto.reportsDir: \"\" explicitly, verify LoadConfig returns validation error containing \"reportsDir\"",
        "Add test: write YAML with auto.branchPrefix: \"\" explicitly, verify LoadConfig returns validation error containing \"branchPrefix\"",
        "go test ./internal/compound/... passes",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-006",
      "title": "Unit tests for FindLatestReport",
      "description": "As a developer, I need unit tests for FindLatestReport so that report discovery is reliable across edge cases.",
      "acceptanceCriteria": [
        "Create internal/compound/analyze_test.go (no integration build tag)",
        "Test: directory with one .md report file returns that file's full path",
        "Test: directory with multiple .md files returns the most recently modified one (use os.Chtimes to control mtime)",
        "Test: empty directory (only .gitkeep) returns error containing \"no reports\" or similar",
        "Test: non-existent directory returns an error",
        "Test: hidden files (e.g., .hidden.md) are skipped and not returned",
        "go test ./internal/compound/... passes",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-007",
      "title": "Unit tests for FindRecentPRDs",
      "description": "As a developer, I need unit tests for FindRecentPRDs so that PRD filtering by age works correctly.",
      "acceptanceCriteria": [
        "Add tests in analyze_test.go for FindRecentPRDs",
        "Test: returns only PRD files (prd-*.md) modified within last N days",
        "Test: excludes PRD files older than N days (use os.Chtimes to set old mtime)",
        "Test: returns nil (not error) when .hal directory does not exist",
        "Test: only matches files with prd- prefix and .md suffix (files like notes.md or prd-foo.txt are excluded)",
        "go test ./internal/compound/... passes",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-008",
      "title": "Unit tests for parseAnalysisResponse",
      "description": "As a developer, I need unit tests for parseAnalysisResponse so that JSON extraction from engine output is robust.",
      "acceptanceCriteria": [
        "Add tests in analyze_test.go for parseAnalysisResponse",
        "Test: valid JSON input returns correct AnalysisResult with all fields populated",
        "Test: JSON wrapped in ```json code fences is extracted correctly",
        "Test: missing priorityItem field returns error",
        "Test: missing branchName field returns error",
        "Test: response with no JSON at all returns error containing \"no JSON object found\"",
        "Test: malformed JSON (e.g., missing closing brace) returns error",
        "Use table-driven test pattern",
        "go test ./internal/compound/... passes",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-009",
      "title": "Verify hal init creates reports directory and installs config",
      "description": "As a developer, I need to verify that hal init correctly creates the reports directory with .gitkeep and installs config.yaml from the embedded template.",
      "acceptanceCriteria": [
        "Add test in cmd/init_test.go that exercises runInit on a temp directory",
        "Verify .hal/reports/ directory is created after runInit",
        "Verify .hal/reports/.gitkeep file exists after runInit",
        "Verify .hal/config.yaml is created with content matching template.DefaultConfig",
        "Verify running runInit a second time does not overwrite existing config.yaml (write custom content, re-run, verify custom content preserved)",
        "go test ./cmd/... passes",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "T-010",
      "title": "Run full test suite and verify no regressions",
      "description": "As a developer, I need to confirm all existing and new tests pass so that the foundation is solid for downstream compound features.",
      "acceptanceCriteria": [
        "make test passes with zero failures",
        "make vet passes with zero warnings",
        "New tests in config_test.go run without integration tag",
        "New tests in analyze_test.go run without integration tag",
        "Existing pipeline_test.go (integration-tagged) still compiles (go build ./internal/compound/...)",
        "Existing init_test.go tests in cmd/ still pass",
        "Existing review_test.go tests still pass",
        "Typecheck passes (go vet ./...)"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    }
  ]
}
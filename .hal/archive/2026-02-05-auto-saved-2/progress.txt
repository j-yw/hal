## Codebase Patterns
- Ldflags variables are in `cmd` package: `cmd.Version`, `cmd.Commit`, `cmd.BuildDate`
- Module path: `github.com/jywlabs/hal`
- GitHub org: `j-yw`, repo: `goralph`
- Homebrew tap repo: `j-yw/homebrew-tap`
- Platform-specific syscall usage must go through `newSysProcAttr()` in `sysproc_unix.go`/`sysproc_windows.go` â€” never use `syscall.SysProcAttr` directly in engine files
- GoReleaser v2 uses `formats` (list) instead of `format` (string) in archives section, and `homebrew_casks` instead of `brews` for Homebrew formulae

---

## 2026-02-05 - US-001
- Created `.goreleaser.yaml` with GoReleaser v2 config
- Files changed: `.goreleaser.yaml` (new)
- **Learnings for future iterations:**
  - GoReleaser v2 requires `version: 2` at the top of the config
  - Windows/arm64 is excluded from builds (only 5 targets total)
  - The `ignore` directive filters out goos/goarch combos from the matrix
  - Brews section uses `repository` (not `tap`) in v2
---

## 2026-02-05 - US-002
- Created `.github/workflows/release.yml` for automated releases on tag push
- Files changed: `.github/workflows/release.yml` (new)
- **Learnings for future iterations:**
  - GoReleaser action v6 uses `version: "~> v2"` syntax
  - Tests run before GoReleaser to gate the release
  - HOMEBREW_TAP_TOKEN is a separate secret from GITHUB_TOKEN (needed for cross-repo push)
---

## 2026-02-05 - US-003
- Created `.github/workflows/ci.yml` with test and goreleaser-check jobs
- Files changed: `.github/workflows/ci.yml` (new)
- **Learnings for future iterations:**
  - CI workflow triggers on push to main/develop and PRs to main
  - Test and goreleaser-check jobs run in parallel (no `needs` dependency)
  - goreleaser-check needs `fetch-depth: 0` for tag history
---

## 2026-02-05 - US-004
- Added `dist/` to `.gitignore` in the binaries section
- Files changed: `.gitignore`
- **Learnings for future iterations:**
  - GoReleaser outputs to `dist/` by default during `--snapshot` and real builds
---

## 2026-02-05 - US-005
- Added `release-dry-run` and `release-check` targets to Makefile
- Files changed: `Makefile`
- **Learnings for future iterations:**
  - `release-dry-run` uses `goreleaser release --snapshot --clean` (snapshot = no publish, clean = remove prior dist/)
  - `release-check` uses `goreleaser check` to validate config
  - Aligned all help text padding when adding new longer target names
---

## 2026-02-05 - US-006
- Verified end-to-end release pipeline: `make release-check` and `make release-dry-run` both exit 0
- Fixed cross-platform build: replaced direct `syscall.SysProcAttr` usage with `newSysProcAttr()` in `claude.go` and `codex.go`
- Added platform-specific `sysproc_unix.go` and `sysproc_windows.go` for both claude and codex engines (were untracked)
- Updated `.goreleaser.yaml` to use GoReleaser v2 `formats` syntax (list instead of scalar)
- Verified all 5 archive files produced: linux/amd64, linux/arm64, darwin/amd64, darwin/arm64, windows/amd64
- Verified checksums.txt contains sha256 hashes for all 5 archives
- Verified each archive contains `hal` binary (`hal.exe` for Windows)
- All tests pass, `go vet` clean
- Files changed: `internal/engine/claude/claude.go`, `internal/engine/codex/codex.go`, `internal/engine/claude/sysproc_unix.go` (new), `internal/engine/claude/sysproc_windows.go` (new), `internal/engine/codex/sysproc_unix.go` (new), `internal/engine/codex/sysproc_windows.go` (new), `.goreleaser.yaml`, `go.mod`, `go.sum`, `.hal/prd.json`, `.hal/progress.txt`
- **Learnings for future iterations:**
  - GoReleaser's before hooks run `go vet` which will catch cross-compilation issues early
  - The `sysproc_*.go` build-tag pattern is essential for cross-platform builds with `syscall` usage
  - GoReleaser v2 changed `format` to `formats` (list) and `brews` to `homebrew_casks`
  - Snapshot builds use version format `0.0.0-SNAPSHOT-<commit>` when no tags exist
---

{
  "project": "goralph",
  "branchName": "ralph/codex-engine-support",
  "description": "Codex CLI Engine Support - Add OpenAI Codex CLI as an alternative engine for executing AI-driven coding tasks",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create Codex engine package structure",
      "description": "As a developer, I need the package structure for the Codex engine so I can implement the integration.",
      "acceptanceCriteria": [
        "Create internal/engine/codex/ directory",
        "Create codex.go with Engine struct implementing engine.Engine interface",
        "Register engine via init() function with engine.RegisterEngine(\"codex\", ...)",
        "Engine returns \"codex\" from Name() method",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement Codex CLI command construction",
      "description": "As the engine, I need to construct proper Codex CLI commands so I can execute prompts non-interactively.",
      "acceptanceCriteria": [
        "CLICommand() returns \"codex\"",
        "BuildArgs() constructs: exec --dangerously-bypass-approvals-and-sandbox --json <prompt>",
        "Arguments include proper flags for non-interactive execution",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implemented as part of US-001"
    },
    {
      "id": "US-003",
      "title": "Implement Codex output parser",
      "description": "As the engine, I need to parse Codex JSONL output so I can provide normalized events to the display.",
      "acceptanceCriteria": [
        "Create parser.go with Parser struct implementing engine.OutputParser",
        "Parse Codex JSONL events into engine.Event types",
        "Map Codex event types to: EventInit, EventTool, EventText, EventResult, EventError",
        "Extract tool names and details from Codex tool_use events",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Implement Execute method",
      "description": "As the engine, I need to execute prompts with streaming output so I can run in the agentic loop.",
      "acceptanceCriteria": [
        "Execute() runs Codex CLI with proper arguments",
        "Streams output through parser to display",
        "Returns engine.Result with success/failure status",
        "Handles timeout with context cancellation",
        "Detaches from TTY using syscall.SysProcAttr{Setsid: true}",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement Prompt method",
      "description": "As the engine, I need a simple prompt method for single-shot requests like PRD generation.",
      "acceptanceCriteria": [
        "Prompt() runs Codex CLI and returns text response",
        "Uses simpler argument set without streaming JSON",
        "Handles timeout with context cancellation",
        "Returns error on failure with stderr details",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement StreamPrompt method",
      "description": "As the engine, I need to stream prompts with display feedback while collecting text response.",
      "acceptanceCriteria": [
        "StreamPrompt() runs with --json flag for JSONL output",
        "Events parsed and shown via display parameter",
        "Text content collected from assistant messages",
        "Returns collected text response on completion",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Add Codex engine tests",
      "description": "As a developer, I need tests to verify the Codex engine implementation.",
      "acceptanceCriteria": [
        "Create codex_test.go with parser unit tests",
        "Test parsing of init, tool_use, result, and error events",
        "Test BuildArgs() produces correct command structure",
        "Test engine registration works (engine.New(\"codex\") succeeds)",
        "All tests pass (go test ./internal/engine/codex/...)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Integration test with Codex CLI",
      "description": "As a developer, I need to verify the engine works end-to-end with the actual Codex CLI.",
      "acceptanceCriteria": [
        "Manually test Execute() with simple prompt",
        "Verify events display correctly during execution",
        "Verify Result reflects actual success/failure",
        "Test Prompt() returns expected text response",
        "Document any Codex-specific quirks discovered"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Integration tests created in integration_test.go with build tag. Run with: go test -tags=integration ./internal/engine/codex/..."
    }
  ]
}
